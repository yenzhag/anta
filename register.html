<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/register.css">
    <link rel="icon" type="images/x-icon" href="./images/favicon.ico">

</head>

<body>

</body>

</html>
<header></header>
<section>
    <div id="main-container">
        <div class="wrapper">
            <div class="wrap">
                <div class="layout">
                    <div class="main-box">
                        <div class="n-fram">
                            <div class="reg-type">
                                <a href="" class="a1">手机注册</a>
                                <a href="" style="color: #999;background-color: #fbfbfb;">邮箱注册</a>
                            </div>
                            <form action="">
                                <div class="regbox">
                                    <h3>请输入手机号码注册：
                                        <span id="text"></span>
                                    </h3>
                                    <div class="inputbg">
                                        <input type="text" placeholder="手机号码" id="username">
                                    </div>
                                    <div class="labelbx">
                                        <input type="text" placeholder="密码" id="password">
                                        <!-- <img src="./images/yzm.png" alt=""> -->
                                    </div>
                                    <div class="agree">
                                        <input type="checkbox" id="agree"> 我已充分阅读、理解并接受
                                        <a href="">个人信息保护政策</a>的全部内容
                                    </div>
                                    <div class="agree-foot">
                                        <input type="button" value="确认" id="submit">
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="web-cover">
            <div id="cover-top"></div>
            <a href="shopping.html" id="cover-cart"></a>
            <a href="" id="cover-kefu"></a>
        </div>

    </div>

</section>
<footer></footer>

<script src="./js/jQuery.js"></script>
<script src="./js/webcover.js"></script>
<script>
    $("header").load("header.html");
    $("footer").load("footer.html");
</script>

<script>
    //判断用户是否存在
    // $("#username").blur(function() {
    //     // var username = $(this).val();
    //     $.ajax({
    //         url: "./goodsAndShoppingCart/checkUser.php",
    //         type: "get",
    //         data: {
    //             username: $("#username").val(),
    //         },
    //         success: function(resText) {
    //             if (resText == 1) {
    //                 $("#text").html("可以注册");
    //             } else if (resText == 0) {
    //                 $("#text").html("用户名已存在");
    //             }
    //             $("#text").css({
    //                 color: "red",
    //             })
    //         }
    //     })
    // })

    //
    let flag = true;

    $("#username").blur(function() {
        let regNum = /^\d{11}$/;
        if ($("#username").val() == "") {
            $("#text").html("手机号不能为空");
        } else if (regNum.test($("#username").val())) {
            $("#text").html("格式正确");
            flag = true;
        } else {
            $("#text").html("格式错误,请重新输入");
            flag = false;
        }
    })


    $("#submit").click(function() {
        if ($("#agree").prop("checked") == false) {
            flag = false;
            alert("请勾选协议");
        } else {
            flag = true;
            $("#text").html("");
        }
        if (flag) {
            $.ajax({
                url: "./goodsAndShoppingCart/checkUser.php",
                type: "get",
                data: {
                    username: $("#username").val(),
                },
                success: function(resText) {
                    console.log(resText);
                    if (resText == 0) {
                        alert("用户名已存在");
                    } else {
                        $.ajax({
                            url: "./goodsAndShoppingCart/addUser.php",
                            type: "post",
                            data: {
                                username: $("#username").val(),
                                userpass: $("#password").val()
                            },
                            success: function(resText) {
                                fun(resText);
                            }
                        })
                    }
                }
            })
        }
    })

    function fun(resText) {
        console.log(resText);
        if (resText.trim() == "success") {
            $("#text").html("注册成功,请登录");
            location.href = "login.html";
        }
    }
</script>